<% provide(:title, '投稿内容') %>
<h3>投稿内容</h3>
    <div class="post">
        <div class="post-box">
            <%= render 'shared/user_bar', micropost: @micropost %>
            <%= link_to("#", class: "post-content") do %>
                <p><%= @micropost.content %></p>
            <% end %>
            <%= render 'shared/post_action_bar', micropost: @micropost %>
        </div>
    </div>

<section class="comment-wrap">
    <h4>コメント</h4>
    <% if @comments.any? %>
        <% @comments.each do |comment| %>
            <div class="comment">
                <div class="post">
                    <div class="post-box">
                        <%= render 'shared/user_bar', micropost: comment %>
                        <%= link_to(micropost_comment_path(comment, comment_id: comment.id), class: "post-content") do %>
                            <p><%= comment.content %></p>
                        <% end %>
                        <%= render 'shared/comment_action_bar', comment: comment %>
                        <% if comment.replies.first.present? %>
                            <div class="latest">
                                <h5>最新返信</h5>
                                <div class="post-box">
                                    <%= render 'shared/user_bar', micropost: comment.replies.first %>
                                    <%= link_to(micropost_comment_path(comment, comment_id: comment.id), class: "post-content") do %>
                                        <p><%= comment.replies.first.content %></p>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                    </div>
                </div>
            </div>
        <% end %>
    <% else %>
        <div class ="post">
            <p class="no-comment">コメントがありません</p>
        </div>
    <% end %>
</section>

<div id="form" class="form-comment">
    <%= form_with(model:[@micropost, @comment], method: :post, local: true) do |f| %>
        <%= hidden_field_tag :micropost_id, @micropost.id %>
        <div class="row">
            <%= f.text_area :content, class: 'form-control', placeholder: "140文字以内にテキストを入力してください", size: "32x2" %>
            <%= f.submit "投稿する", class: "btn btn-sm" %>
        </div>
    <% end %>
</div>