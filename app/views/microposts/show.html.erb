<% provide(:title, '投稿内容') %>
<h3>投稿内容</h3>

<%= render 'shared/post_list', micropost: @micropost %>

<section class="comment-wrap">
    <h4>コメント</h4>
    <% if @comments.any? %>
        <% @comments.each do |comment| %>
            <div class="comment">
                <div class="post">
                    <div class="post-box">
                        <%= link_to(user_path(comment.user), class: "user-bar") do %>
                            <div class="user-image">
                                <img src="" alt="">
                            </div>
                            <div class="user-info">
                                <span class ="user-name"><%= comment.user.name %></span>
                                <span class ="user-major"><%= comment.user.year %><%= comment.user.major %></span>
                            </div>
                            <div class ="time">
                                <%= time_ago_in_words(comment.created_at) %> 
                                <span> ago</span>
                            </div>
                        <% end %>
                        <%= link_to(micropost_comment_path(comment, comment_id: comment.id), class: "post-content") do %>
                            <p><%= comment.content %></p>
                        <% end %>
                    </div>
                    <div class="action-bar">
                        <%= link_to(micropost_comment_path(comment, comment_id: comment.id), class: "reply-btn") do %>
                            <span class="fa fa-comments reply-btn" aria-hidden="true">  <%= comment.replies.count %></span>
                        <% end %>
                    </div>
                    <% if comment.replies.first.present? %>
                        <div class="replies">
                            <h5>最新返信</h5>
                            <div class="post-box">
                                <%= link_to(user_path(comment.replies.first.user), class: "user-bar") do %>
                                    <div class="user-image">
                                        <img src="" alt="">
                                    </div>
                                    <div class="user-info">
                                        <span class ="user-name"><%= comment.replies.first.user.name %></span>
                                        <span class ="user-major"><%= comment.replies.first.user.year %><%= comment.replies.first.user.major %></span>
                                    </div>
                                    <div class ="time">
                                        <%= time_ago_in_words(comment.replies.first.created_at) %> 
                                        <span> ago</span>
                                    </div>
                                <% end %>
                                <%= link_to(micropost_comment_path(comment, comment_id: comment.id), class: "post-content") do %>
                                    <p><%= comment.replies.first.content %></p>
                                <% end %>
                            </div>
                        </div>
                    <% end %>
                </div>
            </div>
        <% end %>
    <% else %>
        <div class ="post">
            <p class="no-comment">コメントがありません</p>
        </div>
    <% end %>
</section>

<div id="form" class="form-comment">
    <%= form_with(model:[@micropost, @comment], method: :post, local: true) do |f| %>
    <%= hidden_field_tag :micropost_id, @micropost.id %>
        <div class="row">
            <%= f.text_area :content, class: 'form-control', placeholder: "140文字以内にテキストを入力してください", size: "32x2" %>
            <%= f.submit "投稿する", class: "btn btn-sm" %>
        </div>
    <% end %>
</div>